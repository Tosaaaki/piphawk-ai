# トレードモード切替の改善案

このドキュメントでは、スキャルピングとトレンドフォローを機械的に切り替えるロジックをさらに発展させるためのアイデアをまとめます。基本となる指標や判定式は `docs/scalp_vs_trend.md` で説明している通りですが、ここではより実運用を意識した工夫を提案します。

## 1. 指標セットの拡張

- **ADX・DI**: ADX が 25 以上でトレンド強度を確認する際に、DI 差の絶対値をスコア化すると細かな勢いの変化を検知しやすくなります。
- **EMA のクロス角度**: 9/21/50EMA の傾きだけでなく、クロス時の角度を算出し、急角度なら加点するようにします。
- **出来高のボラ比率**: Tick Volume をその期間の ATR で割って標準化すると、ペアごとのボラティリティ差を補正できます。

## 2. スコアリング方式の改良

単純な閾値判定ではなく、各カテゴリを 0〜2 点でスコア化して合計点を用います。例えば以下のようにします。

```python
# english prompt inside code
if adx >= 40:
    trend_score += 2
elif adx >= 25:
    trend_score += 1
```

- 合計点が一定以上ならトレンドフォロー、そうでなければスキャルピングとします。
- スコアはローソク足の時間軸ごとに最適化することを想定します。

## 3. 時間帯による重み付け

ロンドン～NY の重複時間帯はトレンドが伸びやすい一方、東京時間はレンジになりやすい傾向があります。時間帯ごとにスコアへ ±1 点の補正を入れることで、裁量に近い判断を機械化できます。

## 4. ログと検証

判定結果と各指標の値を CSV へ書き出し、後でリワインドテストを行えるようにします。スコアごとの勝率を分析することで、閾値や重み付けの最適化が可能になります。

以上の案を取り入れることで、相場状況に応じたトレードモード切替がより精度高く、かつ運用しやすくなるはずです。
